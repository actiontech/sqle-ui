{"swagger":"2.0","info":{"description":"This is a sample server for dev.","title":"Sqle API Docs","contact":{},"license":{},"version":"1.0"},"basePath":"/","paths":{"/v1/audit_whitelist":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get all whitelist","tags":["audit_whitelist"],"summary":"获取Sql审核白名单","operationId":"getAuditWhitelistV1","parameters":[{"type":"string","description":"page index","name":"page_index","in":"query"},{"type":"string","description":"page size","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetAuditWhitelistResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create a sql whitelist","consumes":["application/json"],"tags":["audit_whitelist"],"summary":"添加SQL白名单","operationId":"createAuditWhitelistV1","parameters":[{"description":"add sql whitelist req","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateAuditWhitelistReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/audit_whitelist/{audit_whitelist_id}/":{"delete":{"security":[{"ApiKeyAuth":[]}],"description":"remove sql white","tags":["audit_whitelist"],"summary":"删除SQL白名单信息","operationId":"deleteAuditWhitelistByIdV1","parameters":[{"type":"string","description":"audit whitelist id","name":"audit_whitelist_id","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update sql whitelist by id","consumes":["application/json"],"tags":["audit_whitelist"],"summary":"更新SQL白名单","operationId":"UpdateAuditWhitelistByIdV1","parameters":[{"type":"string","description":"sql audit whitelist id","name":"audit_whitelist_id","in":"path","required":true},{"description":"update sql whitelist req","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateAuditWhitelistReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/dashboard":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get dashboard info","produces":["application/json"],"tags":["dashboard"],"summary":"获取 dashboard 信息","operationId":"getDashboardV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetDashboardResV1"}}}}},"/v1/instance_connection":{"post":{"security":[{"ApiKeyAuth":[]}],"description":"test instance db connection 注：可直接提交创建实例接口的body，该接口的json 内容是创建实例的 json 的子集","consumes":["application/json"],"tags":["instance"],"summary":"实例连通性测试（实例提交前）","operationId":"checkInstanceIsConnectableV1","parameters":[{"description":"instance info","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.GetInstanceConnectableReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstanceConnectableResV1"}}}}},"/v1/instance_tips":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get instance tip list","tags":["instance"],"summary":"获取实例提示列表","operationId":"getInstanceTipListV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstanceTipsResV1"}}}}},"/v1/instances":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get instance info list","tags":["instance"],"summary":"获取实例信息列表","operationId":"getInstanceListV1","parameters":[{"type":"string","description":"filter instance name","name":"filter_instance_name","in":"query"},{"type":"string","description":"filter db host","name":"filter_db_host","in":"query"},{"type":"string","description":"filter db port","name":"filter_db_port","in":"query"},{"type":"string","description":"filter db user","name":"filter_db_user","in":"query"},{"type":"string","description":"filter workflow rule template name","name":"filter_workflow_template_name","in":"query"},{"type":"string","description":"filter rule template name","name":"filter_rule_template_name","in":"query"},{"type":"string","description":"filter role name","name":"filter_role_name","in":"query"},{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstancesResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create a instance","consumes":["application/json"],"tags":["instance"],"summary":"添加实例","operationId":"createInstanceV1","parameters":[{"description":"add instance","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateInstanceReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/instances/{instance_name}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get instance db","tags":["instance"],"summary":"获取实例信息","operationId":"getInstanceV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstanceResV1"}}}},"delete":{"security":[{"ApiKeyAuth":[]}],"description":"delete instance db","tags":["instance"],"summary":"删除实例","operationId":"deleteInstanceV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update instance","tags":["instance"],"summary":"更新实例","operationId":"updateInstanceV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true},{"description":"update instance request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateInstanceReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/instances/{instance_name}/connection":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"test instance db connection","tags":["instance"],"summary":"实例连通性测试（实例提交后）","operationId":"checkInstanceIsConnectableByNameV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstanceConnectableResV1"}}}}},"/v1/instances/{instance_name}/rules":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get instance all rule","tags":["instance"],"summary":"获取实例应用的规则列表","operationId":"getInstanceRuleListV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRulesResV1"}}}}},"/v1/instances/{instance_name}/schemas":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"instance schema list","tags":["instance"],"summary":"实例 Schema 列表","operationId":"getInstanceSchemasV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetInstanceSchemaResV1"}}}}},"/v1/login":{"post":{"description":"user login","tags":["user"],"summary":"用户登录","operationId":"loginV1","parameters":[{"description":"user login request","name":"user","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UserLoginReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetUserLoginResV1"}}}}},"/v1/role_tips":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get role tip list","tags":["role"],"summary":"获取角色提示列表","operationId":"getRoleTipListV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRoleTipsResV1"}}}}},"/v1/roles":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get role list","consumes":["application/json"],"produces":["application/json"],"tags":["role"],"summary":"获取角色列表","operationId":"getRoleListV1","parameters":[{"type":"string","description":"filter role name","name":"filter_role_name","in":"query"},{"type":"string","description":"filter user name","name":"filter_user_name","in":"query"},{"type":"string","description":"filter instance name","name":"filter_instance_name","in":"query"},{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRolesResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create role","consumes":["application/json"],"produces":["application/json"],"tags":["role"],"summary":"创建角色","operationId":"createRoleV1","parameters":[{"description":"create role","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateRoleReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/roles/{role_name}/":{"delete":{"security":[{"ApiKeyAuth":[]}],"description":"delete role","consumes":["application/json"],"produces":["application/json"],"tags":["role"],"summary":"删除角色","operationId":"deleteRoleV1","parameters":[{"type":"string","description":"role name","name":"role_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update role","consumes":["application/json"],"produces":["application/json"],"tags":["role"],"summary":"更新角色信息","operationId":"updateRoleV1","parameters":[{"type":"string","description":"role name","name":"role_name","in":"path","required":true},{"description":"update role request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateRoleReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/rule_template_tips":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get rule template tips","tags":["rule_template"],"summary":"获取规则模板提示","operationId":"getRuleTemplateTipsV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRuleTemplateTipsResV1"}}}}},"/v1/rule_templates":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get all rule template","tags":["rule_template"],"summary":"规则模板列表","operationId":"getRuleTemplateListV1","parameters":[{"type":"string","description":"filter instance name","name":"filter_instance_name","in":"query"},{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRuleTemplatesResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create a rule template","consumes":["application/json"],"tags":["rule_template"],"summary":"添加规则模板","operationId":"createRuleTemplateV1","parameters":[{"description":"add rule template request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateRuleTemplateReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/rule_templates/{rule_template_name}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get rule template","tags":["rule_template"],"summary":"获取规则模板信息","operationId":"getRuleTemplateV1","parameters":[{"type":"string","description":"rule template name","name":"rule_template_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRuleTemplateResV1"}}}},"delete":{"security":[{"ApiKeyAuth":[]}],"description":"delete rule template","tags":["rule_template"],"summary":"删除规则模板","operationId":"deleteRuleTemplateV1","parameters":[{"type":"string","description":"rule template name","name":"rule_template_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update rule template","tags":["rule_template"],"summary":"更新规则模板","operationId":"updateRuleTemplateV1","parameters":[{"type":"string","description":"rule template name","name":"rule_template_name","in":"path","required":true},{"description":"update rule template request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateRuleTemplateReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/rules":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get all rule template","tags":["rule_template"],"summary":"规则列表","operationId":"getRuleListV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetRulesResV1"}}}}},"/v1/tasks/audits":{"post":{"security":[{"ApiKeyAuth":[]}],"description":"create and audit a task. NOTE: it will create a task with sqls from \"sql\" if \"sql\" isn't empty","consumes":["multipart/form-data"],"produces":["application/json"],"tags":["task"],"summary":"创建Sql审核任务并提交审核","operationId":"createAndAuditTaskV1","parameters":[{"type":"string","description":"instance name","name":"instance_name","in":"formData","required":true},{"type":"string","description":"schema of instance","name":"instance_schema","in":"formData"},{"type":"string","description":"sqls for audit","name":"sql","in":"formData"},{"type":"file","description":"input SQL file","name":"input_sql_file","in":"formData"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetAuditTaskResV1"}}}}},"/v1/tasks/audits/{task_id}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get task","tags":["task"],"summary":"获取Sql审核任务信息","operationId":"getAuditTaskV1","parameters":[{"type":"string","description":"task id","name":"task_id","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetAuditTaskResV1"}}}}},"/v1/tasks/audits/{task_id}/sql_file":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"download SQL file for the audit task","tags":["task"],"summary":"下载指定审核任务的SQL文件","operationId":"downloadAuditTaskSQLFileV1","parameters":[{"type":"string","description":"task id","name":"task_id","in":"path","required":true}],"responses":{"200":{"description":"sql file","schema":{"type":"file"}}}}},"/v1/tasks/audits/{task_id}/sql_report":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"download report file of all SQLs information belong to the specified audit task","tags":["task"],"summary":"下载指定审核任务的SQLs信息报告","operationId":"downloadAuditTaskSQLReportV1","parameters":[{"type":"string","description":"task id","name":"task_id","in":"path","required":true},{"type":"boolean","description":"select unique (fingerprint and audit result) for task sql","name":"no_duplicate","in":"query"}],"responses":{"200":{"description":"sql report csv file","schema":{"type":"file"}}}}},"/v1/tasks/audits/{task_id}/sqls":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get information of all SQLs belong to the specified audit task","tags":["task"],"summary":"获取指定审核任务的SQLs信息","operationId":"getAuditTaskSQLsV1","parameters":[{"type":"string","description":"task id","name":"task_id","in":"path","required":true},{"enum":["initialized","doing","succeeded","failed"],"type":"string","description":"filter: exec status of task sql","name":"filter_exec_status","in":"query"},{"enum":["initialized","doing","finished"],"type":"string","description":"filter: audit status of task sql","name":"filter_audit_status","in":"query"},{"type":"boolean","description":"select unique (fingerprint and audit result) for task sql","name":"no_duplicate","in":"query"},{"type":"string","description":"page index","name":"page_index","in":"query"},{"type":"string","description":"page size","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetAuditTaskSQLsResV1"}}}}},"/v1/user":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get current user info","tags":["user"],"summary":"获取当前用户信息","operationId":"getCurrentUserV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetUserDetailResV1"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update current user","consumes":["application/json"],"produces":["application/json"],"tags":["user"],"summary":"更新个人信息","operationId":"updateCurrentUserV1","parameters":[{"description":"update user","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateCurrentUserReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/user_tips":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get user tip list","tags":["user"],"summary":"获取用户提示列表","operationId":"getUserTipListV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetUserTipsResV1"}}}}},"/v1/users":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get user info list","tags":["user"],"summary":"获取用户信息列表","operationId":"getUserListV1","parameters":[{"type":"string","description":"filter user name","name":"filter_user_name","in":"query"},{"type":"string","description":"filter role name","name":"filter_role_name","in":"query"},{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetUsersResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create user","consumes":["application/json"],"produces":["application/json"],"tags":["user"],"summary":"创建用户","operationId":"createUserV1","parameters":[{"description":"create user","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateUserReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/users/{user_name}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get user info","tags":["user"],"summary":"获取用户信息","operationId":"getUserV1","parameters":[{"type":"string","description":"user name","name":"user_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetUserDetailResV1"}}}},"delete":{"security":[{"ApiKeyAuth":[]}],"description":"delete user","tags":["user"],"summary":"删除用户","operationId":"deleteUserV1","parameters":[{"type":"string","description":"user name","name":"user_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update user","consumes":["application/json"],"produces":["application/json"],"tags":["user"],"summary":"更新用户信息","operationId":"updateUserV1","parameters":[{"type":"string","description":"user name","name":"user_name","in":"path","required":true},{"description":"update user","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateUserReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflow_template_tips":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get workflow template tips","tags":["workflow"],"summary":"获取审批流程模板提示信息","operationId":"getWorkflowTemplateTipsV1","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetWorkflowTemplateTipResV1"}}}}},"/v1/workflow_templates":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get workflow template list","tags":["workflow"],"summary":"获取审批流程模板列表","operationId":"getWorkflowTemplateListV1","parameters":[{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetWorkflowTemplatesResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create a workflow template","consumes":["application/json"],"produces":["application/json"],"tags":["workflow"],"summary":"创建Sql审批流程模板","operationId":"createWorkflowTemplateV1","parameters":[{"description":"create workflow template request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateWorkflowTemplateReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflow_templates/{workflow_template_name}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get workflow template detail","tags":["workflow"],"summary":"获取审批流程模板详情","operationId":"getWorkflowTemplateV1","parameters":[{"type":"string","description":"workflow template name","name":"workflow_template_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetWorkflowTemplateResV1"}}}},"delete":{"security":[{"ApiKeyAuth":[]}],"description":"update the workflow template","consumes":["application/json"],"produces":["application/json"],"tags":["workflow"],"summary":"删除Sql审批流程模板","operationId":"deleteWorkflowTemplateV1","parameters":[{"type":"string","description":"workflow template name","name":"workflow_template_name","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}},"patch":{"security":[{"ApiKeyAuth":[]}],"description":"update the workflow template","consumes":["application/json"],"produces":["application/json"],"tags":["workflow"],"summary":"更新Sql审批流程模板","operationId":"updateWorkflowTemplateV1","parameters":[{"type":"string","description":"workflow template name","name":"workflow_template_name","in":"path","required":true},{"description":"create workflow template","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.UpdateWorkflowTemplateReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflows":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get workflow list","tags":["workflow"],"summary":"获取审批流程列表","operationId":"getWorkflowListV1","parameters":[{"type":"string","description":"filter create user name","name":"filter_create_user_name","in":"query"},{"enum":["sql_review","sql_execute"],"type":"string","description":"filter current step type","name":"filter_current_step_type","in":"query"},{"enum":["on_process","finished","rejected","canceled"],"type":"string","description":"filter workflow status","name":"filter_status","in":"query"},{"type":"string","description":"filter current step assignee user name","name":"filter_current_step_assignee_user_name","in":"query"},{"enum":["initialized","audited","executing","exec_success","exec_failed"],"type":"string","description":"filter task status","name":"filter_task_status","in":"query"},{"type":"string","description":"filter instance name","name":"filter_task_instance_name","in":"query"},{"type":"integer","description":"page index","name":"page_index","in":"query"},{"type":"integer","description":"size of per page","name":"page_size","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetWorkflowsResV1"}}}},"post":{"security":[{"ApiKeyAuth":[]}],"description":"create workflow","consumes":["application/json"],"produces":["application/json"],"tags":["workflow"],"summary":"创建工单","operationId":"createWorkflowV1","parameters":[{"description":"create workflow request","name":"instance","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.CreateWorkflowReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflows/{workflow_id}/":{"get":{"security":[{"ApiKeyAuth":[]}],"description":"get workflow detail","tags":["workflow"],"summary":"获取审批流程详情","operationId":"getWorkflowV1","parameters":[{"type":"integer","description":"workflow id","name":"workflow_id","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/v1.GetWorkflowResV1"}}}}},"/v1/workflows/{workflow_id}/cancel":{"post":{"security":[{"ApiKeyAuth":[]}],"description":"cancel workflow","tags":["workflow"],"summary":"审批关闭（中止）","operationId":"cancelWorkflowV1","parameters":[{"type":"string","description":"workflow id","name":"workflow_id","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflows/{workflow_id}/steps/{workflow_step_number}/approve":{"post":{"security":[{"ApiKeyAuth":[]}],"description":"approve workflow","tags":["workflow"],"summary":"审批通过","operationId":"approveWorkflowV1","parameters":[{"type":"string","description":"workflow id","name":"workflow_id","in":"path","required":true},{"type":"string","description":"workflow step number","name":"workflow_step_number","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}},"/v1/workflows/{workflow_id}/steps/{workflow_step_number}/reject":{"post":{"security":[{"ApiKeyAuth":[]}],"description":"reject workflow","tags":["workflow"],"summary":"审批驳回","operationId":"rejectWorkflowV1","parameters":[{"type":"string","description":"workflow id","name":"workflow_id","in":"path","required":true},{"type":"string","description":"workflow step number","name":"workflow_step_number","in":"path","required":true},{"description":"workflow approve request","name":"workflow_approve","in":"body","required":true,"schema":{"$ref":"#/definitions/v1.RejectWorkflowReqV1"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/controller.BaseRes"}}}}}},"definitions":{"controller.BaseRes":{"type":"object","properties":{"code":{"type":"integer","example":0},"message":{"type":"string","example":"ok"}}},"v1.AuditTaskResV1":{"type":"object","properties":{"instance_name":{"type":"string"},"instance_schema":{"type":"string","example":"db1"},"pass_rate":{"type":"number"},"status":{"type":"string","enum":["initialized","audited","executing","exec_success","exec_failed"]},"task_id":{"type":"integer"}}},"v1.AuditTaskSQLResV1":{"type":"object","properties":{"audit_level":{"type":"string"},"audit_result":{"type":"string"},"audit_status":{"type":"string"},"exec_result":{"type":"string"},"exec_sql":{"type":"string"},"exec_status":{"type":"string"},"number":{"type":"integer"},"rollback_sql":{"type":"string"}}},"v1.AuditWhitelistResV1":{"type":"object","properties":{"audit_whitelist_id":{"type":"integer"},"desc":{"type":"string"},"value":{"type":"string"}}},"v1.CreateAuditWhitelistReqV1":{"type":"object","properties":{"desc":{"type":"string","example":"used for rapid release"},"value":{"type":"string","example":"create table"}}},"v1.CreateInstanceReqV1":{"type":"object","properties":{"db_host":{"type":"string","example":"10.10.10.10"},"db_password":{"type":"string","example":"123456"},"db_port":{"type":"string","example":"3306"},"db_user":{"type":"string","example":"root"},"desc":{"type":"string","example":"this is a test instance"},"instance_name":{"type":"string","example":"test"},"role_name_list":{"type":"array","items":{"type":"string"}},"rule_template_name_list":{"type":"array","items":{"type":"string"}},"workflow_template_name":{"type":"string"}}},"v1.CreateRoleReqV1":{"type":"object","properties":{"instance_name_list":{"type":"array","items":{"type":"string"}},"role_desc":{"type":"string"},"role_name":{"type":"string"},"user_name_list":{"type":"array","items":{"type":"string"}}}},"v1.CreateRuleTemplateReqV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"}},"rule_name_list":{"type":"array","items":{"type":"string"},"example":["ddl_check_index_count"]},"rule_template_name":{"type":"string"}}},"v1.CreateUserReqV1":{"type":"object","properties":{"email":{"type":"string","example":"test@email.com"},"role_name_list":{"type":"array","items":{"type":"string"}},"user_name":{"type":"string","example":"test"},"user_password":{"type":"string","example":"123456"}}},"v1.CreateWorkflowReqV1":{"type":"object","properties":{"desc":{"type":"string"},"task_id":{"type":"string"},"workflow_subject":{"type":"string"}}},"v1.CreateWorkflowTemplateReqV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"}},"workflow_step_template_list":{"type":"array","items":{"$ref":"#/definitions/v1.WorkFlowStepTemplateReqV1"}},"workflow_template_name":{"type":"string"}}},"v1.DashboardResV1":{"type":"object","properties":{"workflow_statistics":{"type":"object","$ref":"#/definitions/v1.WorkflowStatisticsResV1"}}},"v1.GetAuditTaskResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.AuditTaskResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetAuditTaskSQLsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.AuditTaskSQLResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetAuditWhitelistResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.AuditWhitelistResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetDashboardResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.DashboardResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetInstanceConnectableReqV1":{"type":"object","properties":{"host":{"type":"string","example":"10.10.10.10"},"password":{"type":"string","example":"123456"},"port":{"type":"string","example":"3306"},"user":{"type":"string","example":"root"}}},"v1.GetInstanceConnectableResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.InstanceConnectableResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetInstanceResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.InstanceResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetInstanceSchemaResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.InstanceSchemaResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetInstanceTipsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.InstanceTipResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetInstancesResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.InstanceResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetRoleTipsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.RoleTipResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetRolesResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.RoleResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetRuleTemplateResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.RuleTemplateDetailResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetRuleTemplateTipsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.RuleTemplateTipResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetRuleTemplatesResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.RuleTemplateDetailResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetRulesResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.RuleResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetUserDetailResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.UserDetailResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetUserLoginResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.UserLoginResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetUserTipsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.UserTipResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetUsersResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.UserResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetWorkflowResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.WorkflowResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetWorkflowTemplateResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"object","$ref":"#/definitions/v1.WorkflowTemplateDetailResV1"},"message":{"type":"string","example":"ok"}}},"v1.GetWorkflowTemplateTipResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.WorkflowTemplateTipResV1"}},"message":{"type":"string","example":"ok"}}},"v1.GetWorkflowTemplatesResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.WorkflowTemplateResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.GetWorkflowsResV1":{"type":"object","properties":{"code":{"type":"integer","example":0},"data":{"type":"array","items":{"$ref":"#/definitions/v1.WorkflowDetailResV1"}},"message":{"type":"string","example":"ok"},"total_nums":{"type":"integer"}}},"v1.InstanceConnectableResV1":{"type":"object","properties":{"connect_error_message":{"type":"string"},"is_instance_connectable":{"type":"boolean"}}},"v1.InstanceResV1":{"type":"object","properties":{"db_host":{"type":"string","example":"10.10.10.10"},"db_port":{"type":"string","example":"3306"},"db_user":{"type":"string","example":"root"},"desc":{"type":"string","example":"this is a instance"},"instance_name":{"type":"string"},"role_name_list":{"type":"array","items":{"type":"string"}},"rule_template_name_list":{"type":"array","items":{"type":"string"}},"workflow_template_name":{"type":"string"}}},"v1.InstanceSchemaResV1":{"type":"object","properties":{"schema_name_list":{"type":"array","items":{"type":"string"}}}},"v1.InstanceTipResV1":{"type":"object","properties":{"instance_name":{"type":"string"}}},"v1.RejectWorkflowReqV1":{"type":"object","properties":{"reason":{"type":"string"}}},"v1.RoleResV1":{"type":"object","properties":{"instance_name_list":{"type":"array","items":{"type":"string"}},"role_desc":{"type":"string"},"role_name":{"type":"string"},"user_name_list":{"type":"array","items":{"type":"string"}}}},"v1.RoleTipResV1":{"type":"object","properties":{"role_name":{"type":"string"}}},"v1.RuleResV1":{"type":"object","properties":{"desc":{"type":"string"},"level":{"type":"string","enum":["normal","notice","warn","error"],"example":"error"},"rule_name":{"type":"string"},"value":{"type":"string"}}},"v1.RuleTemplateDetailResV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"}},"rule_name_list":{"type":"array","items":{"type":"string"}},"rule_template_name":{"type":"string"}}},"v1.RuleTemplateTipResV1":{"type":"object","properties":{"rule_template_name":{"type":"string"}}},"v1.UpdateAuditWhitelistReqV1":{"type":"object","properties":{"desc":{"type":"string","example":"used for rapid release"},"value":{"type":"string","example":"create table"}}},"v1.UpdateCurrentUserReqV1":{"type":"object","properties":{"email":{"type":"string"}}},"v1.UpdateInstanceReqV1":{"type":"object","properties":{"db_host":{"type":"string","example":"10.10.10.10"},"db_password":{"type":"string","example":"123456"},"db_port":{"type":"string","example":"3306"},"db_user":{"type":"string","example":"root"},"desc":{"type":"string","example":"this is a test instance"},"role_name_list":{"type":"array","items":{"type":"string"}},"rule_template_name_list":{"type":"array","items":{"type":"string"}},"workflow_template_name":{"type":"string"}}},"v1.UpdateRoleReqV1":{"type":"object","properties":{"instance_name_list":{"type":"array","items":{"type":"string"}},"role_desc":{"type":"string"},"user_name_list":{"type":"array","items":{"type":"string"}}}},"v1.UpdateRuleTemplateReqV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"},"example":["mysql-xxx"]},"rule_name_list":{"type":"array","items":{"type":"string"},"example":["ddl_check_index_count"]}}},"v1.UpdateUserReqV1":{"type":"object","properties":{"email":{"type":"string"},"role_name_list":{"type":"array","items":{"type":"string"}}}},"v1.UpdateWorkflowTemplateReqV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"}},"workflow_step_template_list":{"type":"array","items":{"$ref":"#/definitions/v1.WorkFlowStepTemplateReqV1"}}}},"v1.UserDetailResV1":{"type":"object","properties":{"email":{"type":"string"},"is_admin":{"type":"boolean"},"role_name_list":{"type":"array","items":{"type":"string"}},"user_name":{"type":"string"}}},"v1.UserLoginReqV1":{"type":"object","properties":{"password":{"type":"string","example":"123456"},"username":{"type":"string","example":"test"}}},"v1.UserLoginResV1":{"type":"object","properties":{"token":{"type":"string","example":"this is a jwt token string"}}},"v1.UserResV1":{"type":"object","properties":{"email":{"type":"string"},"role_name_list":{"type":"array","items":{"type":"string"}},"user_name":{"type":"string"}}},"v1.UserTipResV1":{"type":"object","properties":{"user_name":{"type":"string"}}},"v1.WorkFlowStepTemplateReqV1":{"type":"object","properties":{"assignee_user_name_list":{"type":"array","items":{"type":"string"}},"desc":{"type":"string"},"type":{"type":"string","enum":["sql_review","sql_execute"]}}},"v1.WorkFlowStepTemplateResV1":{"type":"object","properties":{"assignee_user_name_list":{"type":"array","items":{"type":"string"}},"desc":{"type":"string"},"number":{"type":"integer"},"type":{"type":"string"}}},"v1.WorkflowDetailResV1":{"type":"object","properties":{"create_time":{"type":"string"},"create_user_name":{"type":"string"},"current_step_assignee_user_name_list":{"type":"array","items":{"type":"string"}},"current_step_type":{"type":"string","enum":["sql_review","sql_execute"]},"desc":{"type":"string"},"status":{"type":"string","enum":["on_process","finished","rejected","canceled"]},"subject":{"type":"string"},"task_instance_name":{"type":"string"},"task_instance_schema":{"type":"string"},"task_pass_rate":{"type":"number"},"task_status":{"type":"string","enum":["initialized","audited","executing","exec_success","exec_failed"]},"workflow_id":{"type":"integer"}}},"v1.WorkflowResV1":{"type":"object","properties":{"create_time":{"type":"string"},"create_user_name":{"type":"string"},"current_step_number":{"type":"integer"},"desc":{"type":"string"},"status":{"type":"string","enum":["on_process","finished","rejected","canceled"]},"subject":{"type":"string"},"task_id":{"type":"integer"},"workflow_id":{"type":"integer"},"workflow_step_list":{"type":"array","items":{"$ref":"#/definitions/v1.WorkflowStepResV1"}}}},"v1.WorkflowStatisticsResV1":{"type":"object","properties":{"my_on_process_workflow_number":{"type":"integer"},"my_rejected_workflow_number":{"type":"integer"},"need_me_to_execute_workflow_number":{"type":"integer"},"need_me_to_review_workflow_number":{"type":"integer"}}},"v1.WorkflowStepResV1":{"type":"object","properties":{"assignee_user_name_list":{"type":"array","items":{"type":"string"}},"desc":{"type":"string"},"number":{"type":"integer"},"operation_time":{"type":"string"},"operation_user_name":{"type":"string"},"reason":{"type":"string"},"state":{"type":"string","enum":["initialized","approved","rejected"]},"type":{"type":"string"}}},"v1.WorkflowTemplateDetailResV1":{"type":"object","properties":{"desc":{"type":"string"},"instance_name_list":{"type":"array","items":{"type":"string"}},"workflow_step_template_list":{"type":"array","items":{"$ref":"#/definitions/v1.WorkFlowStepTemplateResV1"}},"workflow_template_name":{"type":"string"}}},"v1.WorkflowTemplateResV1":{"type":"object","properties":{"desc":{"type":"string"},"workflow_template_name":{"type":"string"}}},"v1.WorkflowTemplateTipResV1":{"type":"object","properties":{"workflow_template_name":{"type":"string"}}}},"securityDefinitions":{"ApiKeyAuth":{"type":"apiKey","name":"Authorization","in":"header"}}}